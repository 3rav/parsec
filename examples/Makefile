CC=mpicc
CFLAGS=-Wall `pkg-config --cflags parsec` -g3
LDFLAGS=`pkg-config --libs parsec` -pthread -lm -lrt -ldl -lcudart

DAGUEPP=daguepp
DAGUEPPFLAGS=

EXAMPLES= Ex01_HelloWorld \
	  Ex02_Chain    \
	  Ex03_ChainMPI    \


# Keep intermediate .c/.h files generated by daguepp
EXAMPLES_C=${EXAMPLES:=.c}
EXAMPLES_H=${EXAMPLES:=.h}

.SECONDARY: ${EXAMPLES_H} ${EXAMPLES_C}

default: Ex00_StartStop ${EXAMPLES}


Ex00_StartStop: Ex00_StartStop.o
	${CC} -o $@ $< ${CFLAGS} ${LDFLAGS}

%.c: %.jdf
	${DAGUEPP} -i $< -o `basename $@ .c` ${DAGUEPPFLAGS} -- ${CFLAGS}

%.o: %.c
	${CC} -o $@ -c $< ${CFLAGS}

Ex01_HelloWorld: Ex01_HelloWorld.o
	${CC} -o $@ $< ${CFLAGS} ${LDFLAGS}

Ex02_Chain: Ex02_Chain.o
	${CC} -o $@ $< ${CFLAGS} ${LDFLAGS}

Ex03_ChainMPI: Ex03_ChainMPI.o
	${CC} -o $@ $< ${CFLAGS} ${LDFLAGS}

clean:
	rm -f *.o

cleanall: clean
	rm -f Ex00_StartStop ${EXAMPLES} ${EXAMPLES_C} ${EXAMPLES_H}
